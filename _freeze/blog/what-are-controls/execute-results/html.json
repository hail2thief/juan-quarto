{
  "hash": "5dde9c1eaa11ecff0b964ea7e999a447",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"What do controls do?\"\ndate: \"2026-01-01\"\nauthor: \"Juan Tellez\"\nformat: html\ntoc: true\ncategories: [R, causality]\n---\n\n\n\n\n\n\n## Introduction\n\n\nI remember being confused in grad school about the use of *controls* in regression analysis. The problem was clear: we have a situation where we want to estimate the effect of $X$ on $Y$, but there is a third variable, $Z$, that affects both $X$ and $Y$. $Z$ will confound our estimates of $X$ on $Y$, so we need to \"control for\" $Z$ in our regression.\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](what-are-controls_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nBut what does it mean to \"control\" for Z? What are we trying to do, exactly?\n\n\nSome textbooks discuss controlling in terms of comparisons. Here's Gelman in *Regression and other stories*:\n\n> We interpret the regression slopes as comparisons of individuals that differ in one predictor while being at the same levels of the other predictors.\n\nOr from *The Effect*:\n\n> If two observations have the same values of the other variables in the model, but one has a value ofùëã  that is one unit higher, the observation with the X one unit higher will on average have aùëåthat is B1 units higher\n\n\nI love this intuition. We'd say that *comparing two people of identical Z*, we'd expect someone with an additional year of $X$ to have $\\beta_1$ more in $Y$.\n\n\nBut how is regression *doing this*? What about the regression makes this comparison possible?\n\n\nHere is one way of thinking about this that clarified regression *controls* for me and their limitations.\n\n\n## Example: ideology and campaign finance\n\n\nSay we're looking at Adam Bonica's data on campaign finance, from my `{juanr}` package. Each row is a political candidate:\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Sample of Bonica's campaign finance data</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> cycle </th>\n   <th style=\"text-align:center;\"> name </th>\n   <th style=\"text-align:center;\"> party </th>\n   <th style=\"text-align:center;\"> dwnom1 </th>\n   <th style=\"text-align:center;\"> state </th>\n   <th style=\"text-align:center;\"> district </th>\n   <th style=\"text-align:center;\"> seat </th>\n   <th style=\"text-align:center;\"> incumbent </th>\n   <th style=\"text-align:center;\"> gender </th>\n   <th style=\"text-align:center;\"> num_distinct_donors </th>\n   <th style=\"text-align:center;\"> total_receipts </th>\n   <th style=\"text-align:center;\"> contribs_from_candidate </th>\n   <th style=\"text-align:center;\"> total_disbursements </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 2018 </td>\n   <td style=\"text-align:center;\"> Van Risseghem, Anthony L </td>\n   <td style=\"text-align:center;\"> R </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> WY </td>\n   <td style=\"text-align:center;\"> WYS18 </td>\n   <td style=\"text-align:center;\"> senate </td>\n   <td style=\"text-align:center;\"> challenger </td>\n   <td style=\"text-align:center;\"> M </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 2018 </td>\n   <td style=\"text-align:center;\"> Holtz, John </td>\n   <td style=\"text-align:center;\"> R </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> WY </td>\n   <td style=\"text-align:center;\"> WYS18 </td>\n   <td style=\"text-align:center;\"> senate </td>\n   <td style=\"text-align:center;\"> challenger </td>\n   <td style=\"text-align:center;\"> M </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 2018 </td>\n   <td style=\"text-align:center;\"> Hardy, Charles E </td>\n   <td style=\"text-align:center;\"> R </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> WY </td>\n   <td style=\"text-align:center;\"> WYS18 </td>\n   <td style=\"text-align:center;\"> senate </td>\n   <td style=\"text-align:center;\"> challenger </td>\n   <td style=\"text-align:center;\"> M </td>\n   <td style=\"text-align:center;\"> 39 </td>\n   <td style=\"text-align:center;\"> 8633 </td>\n   <td style=\"text-align:center;\"> 1843 </td>\n   <td style=\"text-align:center;\"> 8475 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 2018 </td>\n   <td style=\"text-align:center;\"> De La Fuente, Roque Rocky </td>\n   <td style=\"text-align:center;\"> D </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> WY </td>\n   <td style=\"text-align:center;\"> WYS18 </td>\n   <td style=\"text-align:center;\"> senate </td>\n   <td style=\"text-align:center;\"> challenger </td>\n   <td style=\"text-align:center;\"> M </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 2018 </td>\n   <td style=\"text-align:center;\"> Miller, Rod </td>\n   <td style=\"text-align:center;\"> R </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> WY </td>\n   <td style=\"text-align:center;\"> WY01 </td>\n   <td style=\"text-align:center;\"> house </td>\n   <td style=\"text-align:center;\"> challenger </td>\n   <td style=\"text-align:center;\"> M </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 2018 </td>\n   <td style=\"text-align:center;\"> Stanley, Blake </td>\n   <td style=\"text-align:center;\"> R </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> WY </td>\n   <td style=\"text-align:center;\"> WY01 </td>\n   <td style=\"text-align:center;\"> house </td>\n   <td style=\"text-align:center;\"> challenger </td>\n   <td style=\"text-align:center;\"> M </td>\n   <td style=\"text-align:center;\"> NA </td>\n   <td style=\"text-align:center;\"> 5820 </td>\n   <td style=\"text-align:center;\"> 4250 </td>\n   <td style=\"text-align:center;\"> 4314 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\nSay we wanted to estimate the effect of ideology (`dwnom1`) on the amount of money raised (`total_receipts`). `dwnom1` measures ideology using the DW-NOMINATE score, which theoretically ranges from -1 (left-wing) to 1 (right-wing).\n\n\nWe estimate this simple model:\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_jii0dzoiluo05wns1afe = TinyTable.createTableFunctions(\"tinytable_jii0dzoiluo05wns1afe\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '5', j: 2 } ], css_id: 'tinytable_css_7hucfmq33i6nygefpwev',}, \n          { positions: [ { i: '4', j: 2 } ], css_id: 'tinytable_css_61uhl7dluzeu8ccdpnku',}, \n          { positions: [ { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '3', j: 2 } ], css_id: 'tinytable_css_ffnt2y8j71dxssyv8rms',}, \n          { positions: [ { i: '0', j: 2 } ], css_id: 'tinytable_css_o4mi5ibkdhtwo5ys0x8u',}, \n          { positions: [ { i: '5', j: 1 } ], css_id: 'tinytable_css_0nhc0mis8fm0u3up71kb',}, \n          { positions: [ { i: '4', j: 1 } ], css_id: 'tinytable_css_jtx1utrlp7r99cfi99mp',}, \n          { positions: [ { i: '1', j: 1 }, { i: '2', j: 1 }, { i: '3', j: 1 } ], css_id: 'tinytable_css_b7sx62vq38z9evb60i8n',}, \n          { positions: [ { i: '0', j: 1 } ], css_id: 'tinytable_css_awn4kro3fmnm99shrofe',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_jii0dzoiluo05wns1afe.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_jii0dzoiluo05wns1afe td.tinytable_css_7hucfmq33i6nygefpwev, #tinytable_jii0dzoiluo05wns1afe th.tinytable_css_7hucfmq33i6nygefpwev {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }\n    #tinytable_jii0dzoiluo05wns1afe td.tinytable_css_61uhl7dluzeu8ccdpnku, #tinytable_jii0dzoiluo05wns1afe th.tinytable_css_61uhl7dluzeu8ccdpnku {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }\n    #tinytable_jii0dzoiluo05wns1afe td.tinytable_css_ffnt2y8j71dxssyv8rms, #tinytable_jii0dzoiluo05wns1afe th.tinytable_css_ffnt2y8j71dxssyv8rms { text-align: center }\n    #tinytable_jii0dzoiluo05wns1afe td.tinytable_css_o4mi5ibkdhtwo5ys0x8u, #tinytable_jii0dzoiluo05wns1afe th.tinytable_css_o4mi5ibkdhtwo5ys0x8u {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }\n    #tinytable_jii0dzoiluo05wns1afe td.tinytable_css_0nhc0mis8fm0u3up71kb, #tinytable_jii0dzoiluo05wns1afe th.tinytable_css_0nhc0mis8fm0u3up71kb {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }\n    #tinytable_jii0dzoiluo05wns1afe td.tinytable_css_jtx1utrlp7r99cfi99mp, #tinytable_jii0dzoiluo05wns1afe th.tinytable_css_jtx1utrlp7r99cfi99mp {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }\n    #tinytable_jii0dzoiluo05wns1afe td.tinytable_css_b7sx62vq38z9evb60i8n, #tinytable_jii0dzoiluo05wns1afe th.tinytable_css_b7sx62vq38z9evb60i8n { text-align: left }\n    #tinytable_jii0dzoiluo05wns1afe td.tinytable_css_awn4kro3fmnm99shrofe, #tinytable_jii0dzoiluo05wns1afe th.tinytable_css_awn4kro3fmnm99shrofe {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_jii0dzoiluo05wns1afe\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\"> </th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">No controls</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='2'>+ p < 0.1, * p < 0.05, ** p < 0.01, *** p < 0.001</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">(Intercept)</td>\n                  <td data-row=\"1\" data-col=\"2\">2418569.034***</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\"></td>\n                  <td data-row=\"2\" data-col=\"2\">(105407.946)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">dwnom1</td>\n                  <td data-row=\"3\" data-col=\"2\">-258416.541</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\"></td>\n                  <td data-row=\"4\" data-col=\"2\">(225672.845)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"1\">Num.Obs.</td>\n                  <td data-row=\"5\" data-col=\"2\">1670</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\n\nWe see that more left-wing candidates tend to raise more money: going from a perfect moderate to a perfect left-winger results in a $258,416 increase in fundraising. Considering the median candidate raises about 15k, this is sizable.\n\n\nMany things might confound this relationship. One potential confound ($Z$) is political party: the parties systematically have different ideologies and might also have different fundraising capacities. So we control for party:\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<!-- preamble start -->\n\n    <script src=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js\"></script>\n\n    <script>\n      // Create table-specific functions using external factory\n      const tableFns_viii28asnu4un6pkf0qg = TinyTable.createTableFunctions(\"tinytable_viii28asnu4un6pkf0qg\");\n      // tinytable span after\n      window.addEventListener('load', function () {\n          var cellsToStyle = [\n            // tinytable style arrays after\n          { positions: [ { i: '9', j: 2 }, { i: '9', j: 3 } ], css_id: 'tinytable_css_x98ioof7ra5lghuzclst',}, \n          { positions: [ { i: '8', j: 2 }, { i: '8', j: 3 } ], css_id: 'tinytable_css_1rp8xbfolq35c7sogiag',}, \n          { positions: [ { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '3', j: 2 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '1', j: 3 }, { i: '2', j: 3 }, { i: '3', j: 3 }, { i: '4', j: 3 }, { i: '5', j: 3 }, { i: '6', j: 3 }, { i: '7', j: 3 } ], css_id: 'tinytable_css_5wshrgcc9pmwjjt4yvi1',}, \n          { positions: [ { i: '0', j: 2 }, { i: '0', j: 3 } ], css_id: 'tinytable_css_k2z3xwlo2yoo4fvx3o0h',}, \n          { positions: [ { i: '9', j: 1 } ], css_id: 'tinytable_css_7fjv9d9kvyqjipn0a98x',}, \n          { positions: [ { i: '8', j: 1 } ], css_id: 'tinytable_css_vuedbdd550ynsgjufcvz',}, \n          { positions: [ { i: '1', j: 1 }, { i: '2', j: 1 }, { i: '3', j: 1 }, { i: '4', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 } ], css_id: 'tinytable_css_7p714z8fisvwel67p1xc',}, \n          { positions: [ { i: '0', j: 1 } ], css_id: 'tinytable_css_qgvptqhq7xazy7wdz3i1',}, \n          ];\n\n          // Loop over the arrays to style the cells\n          cellsToStyle.forEach(function (group) {\n              group.positions.forEach(function (cell) {\n                  tableFns_viii28asnu4un6pkf0qg.styleCell(cell.i, cell.j, group.css_id);\n              });\n          });\n      });\n    </script>\n\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css\">\n    <style>\n    /* tinytable css entries after */\n    #tinytable_viii28asnu4un6pkf0qg td.tinytable_css_x98ioof7ra5lghuzclst, #tinytable_viii28asnu4un6pkf0qg th.tinytable_css_x98ioof7ra5lghuzclst {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }\n    #tinytable_viii28asnu4un6pkf0qg td.tinytable_css_1rp8xbfolq35c7sogiag, #tinytable_viii28asnu4un6pkf0qg th.tinytable_css_1rp8xbfolq35c7sogiag {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }\n    #tinytable_viii28asnu4un6pkf0qg td.tinytable_css_5wshrgcc9pmwjjt4yvi1, #tinytable_viii28asnu4un6pkf0qg th.tinytable_css_5wshrgcc9pmwjjt4yvi1 { text-align: center }\n    #tinytable_viii28asnu4un6pkf0qg td.tinytable_css_k2z3xwlo2yoo4fvx3o0h, #tinytable_viii28asnu4un6pkf0qg th.tinytable_css_k2z3xwlo2yoo4fvx3o0h {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }\n    #tinytable_viii28asnu4un6pkf0qg td.tinytable_css_7fjv9d9kvyqjipn0a98x, #tinytable_viii28asnu4un6pkf0qg th.tinytable_css_7fjv9d9kvyqjipn0a98x {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }\n    #tinytable_viii28asnu4un6pkf0qg td.tinytable_css_vuedbdd550ynsgjufcvz, #tinytable_viii28asnu4un6pkf0qg th.tinytable_css_vuedbdd550ynsgjufcvz {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }\n    #tinytable_viii28asnu4un6pkf0qg td.tinytable_css_7p714z8fisvwel67p1xc, #tinytable_viii28asnu4un6pkf0qg th.tinytable_css_7p714z8fisvwel67p1xc { text-align: left }\n    #tinytable_viii28asnu4un6pkf0qg td.tinytable_css_qgvptqhq7xazy7wdz3i1, #tinytable_viii28asnu4un6pkf0qg th.tinytable_css_qgvptqhq7xazy7wdz3i1 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: black; --line-color-left: black; --line-color-right: black; --line-color-top: black; --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }\n    </style>\n    <div class=\"container\">\n      <table class=\"tinytable\" id=\"tinytable_viii28asnu4un6pkf0qg\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        \n        <thead>\n              <tr>\n                <th scope=\"col\" data-row=\"0\" data-col=\"1\"> </th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"2\">No controls</th>\n                <th scope=\"col\" data-row=\"0\" data-col=\"3\">Control for party</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='3'>+ p < 0.1, * p < 0.05, ** p < 0.01, *** p < 0.001</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td data-row=\"1\" data-col=\"1\">(Intercept)</td>\n                  <td data-row=\"1\" data-col=\"2\">2418569.034***</td>\n                  <td data-row=\"1\" data-col=\"3\">3177880.673***</td>\n                </tr>\n                <tr>\n                  <td data-row=\"2\" data-col=\"1\"></td>\n                  <td data-row=\"2\" data-col=\"2\">(105407.946)</td>\n                  <td data-row=\"2\" data-col=\"3\">(364378.861)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"3\" data-col=\"1\">dwnom1</td>\n                  <td data-row=\"3\" data-col=\"2\">-258416.541</td>\n                  <td data-row=\"3\" data-col=\"3\">1469866.143+</td>\n                </tr>\n                <tr>\n                  <td data-row=\"4\" data-col=\"1\"></td>\n                  <td data-row=\"4\" data-col=\"2\">(225672.845)</td>\n                  <td data-row=\"4\" data-col=\"3\">(814742.914)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"5\" data-col=\"1\">partyI</td>\n                  <td data-row=\"5\" data-col=\"2\"></td>\n                  <td data-row=\"5\" data-col=\"3\">-3325724.986***</td>\n                </tr>\n                <tr>\n                  <td data-row=\"6\" data-col=\"1\"></td>\n                  <td data-row=\"6\" data-col=\"2\"></td>\n                  <td data-row=\"6\" data-col=\"3\">(457391.359)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"7\" data-col=\"1\">partyR</td>\n                  <td data-row=\"7\" data-col=\"2\"></td>\n                  <td data-row=\"7\" data-col=\"3\">-1653810.976*</td>\n                </tr>\n                <tr>\n                  <td data-row=\"8\" data-col=\"1\"></td>\n                  <td data-row=\"8\" data-col=\"2\"></td>\n                  <td data-row=\"8\" data-col=\"3\">(727629.657)</td>\n                </tr>\n                <tr>\n                  <td data-row=\"9\" data-col=\"1\">Num.Obs.</td>\n                  <td data-row=\"9\" data-col=\"2\">1670</td>\n                  <td data-row=\"9\" data-col=\"3\">1670</td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n<!-- hack to avoid NA insertion in last line -->\n```\n\n:::\n:::\n\n\nNow the story is completely different: controlling for party, we see that more left-wing candidates raise *less* money. Going from a perfect moderate to a perfect left-winger results in almost 1.5 million *less* in fundraising.\n\n\nUsing the \"comparisons\" language from the textbooks, we can say that *comparing two candidates from the same party*, the more left-wing candidate raises less money.\n\n\nBut how do we get here?\n\n\n## Stratification\n\n\nOne way to think about the \"comparisons\" interpretation of controls is as a kind of **stratification**: when we control for $Z$, what we would like to do is see if the relationship between $X$ and $Y$ \"holds\" *within* levels of $Z$.\n\nTo put it in the \"defensive\" terms in which researchers typically operate, if someone says that the relationship between $X$ and $Y$ is confounded by $Z$, we can respond: \"Well, if we look at two people with the same $Z$, do we still see a relationship between $X$ and $Y$?\" If yes, then we can say that the relationship between $X$ and $Y$ is not fully explained by $Z$.\n\n\nIn our case, this would look like estimating the relationship between ideology and fundraising *within* each of the three parties in the data (Democrats, Republicans, and Independents):\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbonica |>\n  group_by(party) |>\n  summarise(\n    mod = list(lm_robust(total_receipts ~ dwnom1, data = cur_data()))\n  ) |>\n  mutate(tidy_mod = map(mod, broom::tidy)) |>\n  unnest(tidy_mod) |>\n  filter(term == \"dwnom1\") |>\n  select(party, estimate, std.error, p.value) |>\n  my_kbl(caption = \"Effect of ideology on fundraising, by party\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Effect of ideology on fundraising, by party</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> party </th>\n   <th style=\"text-align:center;\"> estimate </th>\n   <th style=\"text-align:center;\"> std.error </th>\n   <th style=\"text-align:center;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> D </td>\n   <td style=\"text-align:center;\"> 5705276 </td>\n   <td style=\"text-align:center;\"> 2140241 </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> I </td>\n   <td style=\"text-align:center;\"> 52320 </td>\n   <td style=\"text-align:center;\"> 11542 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> R </td>\n   <td style=\"text-align:center;\"> -517739 </td>\n   <td style=\"text-align:center;\"> 714436 </td>\n   <td style=\"text-align:center;\"> 0.47 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nWe see that within each party, the relationship between ideology and fundraising is different, big and positive for Democrats, big and negative for Republicans, and weakly positive for Independents.\n\n\nSo how do we get from these three estimates to one overall estimate that *controls for party*, as in the model at the top of the page?\n\n\nThe answer is that regression is doing a kind of weighted average of these within-group estimates. But it's not a simple average ‚Äî the weights depend on specific features of each group.\n\n\n## The weighting formula\n\n\nWhen we estimate `lm(Y ~ X + Z)` where $Z$ is categorical, the coefficient on $X$ is a weighted average of the within-group slopes:\n\n$$\n\\hat{\\beta}_{\\text{pooled}} = \\frac{\\sum_{g=1}^{G} w_g \\cdot \\hat{\\beta}_g}{\\sum_{g=1}^{G} w_g}\n$$\n\nwhere $\\hat{\\beta}_g$ is the slope of $X$ on $Y$ estimated within group $g$, and the weight $w_g$ is:\n\n$$\nw_g = (n_g - 1) \\cdot \\text{Var}_g(X)\n$$\n\nThat is, the weight for each group reflects two things:\n\n1. **Group size**: groups with more observations contribute more squared deviations, so they get more weight. This makes sense ‚Äî we have more information about the relationship in larger groups.\n2. **Within-group variance of $X$**: groups where the treatment variable $X$ varies more get more weight. This also makes sense ‚Äî if everyone in a group has the same value of $X$, we can't learn anything about the effect of $X$ from that group.\n\nThis is an important result. It tells us that when we \"control for $Z$\", we are not giving equal voice to every level of $Z$. We are letting the levels of $Z$ that have more data and more variation in $X$ drive the overall estimate.\n\n\n## Checking this with the Bonica data\n\n\nLet's verify this with our running example. First, we compute the within-party slopes, group sizes, and variances of ideology:\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# drop rows with missing ideology or receipts (same as lm does internally)\nbonica_complete <- bonica |>\n  filter(!is.na(dwnom1), !is.na(total_receipts))\n\n# within-party estimates, sample sizes, and variance of X\nstrat <- bonica_complete |>\n  group_by(party) |>\n  summarise(\n    beta_g = coef(lm(total_receipts ~ dwnom1))[\"dwnom1\"],\n    n_g = n(),\n    var_g = var(dwnom1)\n  ) |>\n  mutate(\n    weight = (n_g - 1) * var_g\n  )\n\nstrat |>\n  my_kbl(caption = \"Within-party estimates and weights\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Within-party estimates and weights</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> party </th>\n   <th style=\"text-align:center;\"> beta_g </th>\n   <th style=\"text-align:center;\"> n_g </th>\n   <th style=\"text-align:center;\"> var_g </th>\n   <th style=\"text-align:center;\"> weight </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> D </td>\n   <td style=\"text-align:center;\"> 5705276 </td>\n   <td style=\"text-align:center;\"> 770 </td>\n   <td style=\"text-align:center;\"> 0.02 </td>\n   <td style=\"text-align:center;\"> 12.07 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> I </td>\n   <td style=\"text-align:center;\"> 52320 </td>\n   <td style=\"text-align:center;\"> 9 </td>\n   <td style=\"text-align:center;\"> 0.06 </td>\n   <td style=\"text-align:center;\"> 0.48 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> R </td>\n   <td style=\"text-align:center;\"> -517739 </td>\n   <td style=\"text-align:center;\"> 891 </td>\n   <td style=\"text-align:center;\"> 0.03 </td>\n   <td style=\"text-align:center;\"> 25.38 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nNow we can compute the weighted average and compare it to the OLS estimate:\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# weighted average of within-party slopes\nbeta_weighted <- with(strat, sum(weight * beta_g) / sum(weight))\n\n# OLS with party control\nbeta_ols <- coef(lm(total_receipts ~ dwnom1 + party, data = bonica_complete))[\"dwnom1\"]\n\ntibble(\n  `Weighted average` = beta_weighted,\n  `OLS with controls` = beta_ols\n) |>\n  my_kbl(caption = \"Stratified weighted average vs. OLS coefficient\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Stratified weighted average vs. OLS coefficient</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> Weighted average </th>\n   <th style=\"text-align:center;\"> OLS with controls </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 1469866 </td>\n   <td style=\"text-align:center;\"> 1469866 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\nThe two estimates are the same.^[There can be minor numerical differences due to floating point arithmetic, but they are substantively identical.] This confirms that \"controlling for party\" in OLS is equivalent to: (1) estimating the ideology-fundraising relationship separately within each party, and (2) taking a weighted average of those estimates, where groups with more observations and more ideological variation get more influence.\n\n\nLook back at the weights in the table above. This tells us which parties are driving the overall estimate. If one party has far more candidates and more spread in ideology, its within-party slope will dominate the controlled estimate.\n\n\n## What this tells us about controls\n\n\nThis decomposition clarifies a few things about what controls do and don't do:\n\n\n1. **Controls are about within-group comparisons.** When we control for $Z$, we are comparing units that share the same value of $Z$. The regression coefficient is a summary of these within-group relationships.\n\n2. **The summary is not a simple average.** Groups with more data and more variation in $X$ contribute more. This means the controlled estimate might be driven by a subset of the data that you didn't intend to emphasize.\n\n3. **With categorical controls, the logic is transparent.** We can literally split the data, estimate within each group, and see how the pieces combine. This is a good exercise to build intuition.\n\n4. **With continuous controls, we're trusting linearity.** When $Z$ is continuous, we can't literally stratify ‚Äî there are too many unique values of $Z$. Instead, regression assumes the relationship between $Z$ and $Y$ is linear. This is a stronger assumption than the categorical case, where we make no assumptions about the shape of the $Z$-$Y$ relationship within each group. If the true relationship between $Z$ and $Y$ is nonlinear, a linear control for $Z$ may not fully remove the confounding. This is one reason why researchers sometimes use flexible controls (polynomials, splines, or fixed effects for binned continuous variables) ‚Äî they're trying to get closer to the stratification ideal.\n\n\n## The residuals approach: Frisch-Waugh-Lovell\n\n\nThere is a second way of thinking about what controls do that complements the stratification approach. Instead of asking \"what is the relationship between $X$ and $Y$ *within* levels of $Z$?\", we can ask: \"what is the relationship between the parts of $X$ and $Y$ that *can't be explained by* $Z$?\"\n\nThis is the idea behind the **Frisch-Waugh-Lovell (FWL) theorem**. The theorem says that the coefficient on $X$ in `lm(Y ~ X + Z)` is identical to the coefficient you get from the following three-step procedure:\n\n1. Regress $Y$ on $Z$ and save the residuals. Call these $\\tilde{Y}$. These are the parts of $Y$ that $Z$ can't explain.\n2. Regress $X$ on $Z$ and save the residuals. Call these $\\tilde{X}$. These are the parts of $X$ that $Z$ can't explain.\n3. Regress $\\tilde{Y}$ on $\\tilde{X}$.\n\nThe coefficient from step 3 is the same as the coefficient on $X$ from the full model.\n\nThe intuition is straightforward: if $Z$ confounds the relationship between $X$ and $Y$, we can remove its influence by stripping out everything $Z$ explains from both variables. What's left over ‚Äî the residuals ‚Äî are the \"pure\" variation in $X$ and $Y$, free of $Z$. The relationship between those residuals is the controlled estimate.\n\n\n### Checking FWL with the Bonica data\n\n\nLet's verify this with our running example. We regress fundraising on party, save the residuals. Regress ideology on party, save the residuals. Then regress one on the other:\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# step 1: residualize Y (fundraising) on Z (party)\nresid_y <- residuals(lm(total_receipts ~ party, data = bonica_complete))\n\n# step 2: residualize X (ideology) on Z (party)\nresid_x <- residuals(lm(dwnom1 ~ party, data = bonica_complete))\n\n# step 3: regress residualized Y on residualized X\nbeta_fwl <- coef(lm(resid_y ~ resid_x))[\"resid_x\"]\n\ntibble(\n  `OLS with controls` = beta_ols,\n  `Stratification (weighted avg)` = beta_weighted,\n  `FWL (residuals)` = beta_fwl\n) |>\n  my_kbl(caption = \"Three equivalent ways to get the controlled estimate\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Three equivalent ways to get the controlled estimate</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> OLS with controls </th>\n   <th style=\"text-align:center;\"> Stratification (weighted avg) </th>\n   <th style=\"text-align:center;\"> FWL (residuals) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 1469866 </td>\n   <td style=\"text-align:center;\"> 1469866 </td>\n   <td style=\"text-align:center;\"> 1469866 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\nAll three approaches produce the same coefficient.\n\nBecause party is categorical, the residuals here have a nice interpretation: they are just the group-demeaned values. The residual of a Democrat's ideology score is how far their ideology is from the average Democrat's ideology. The residual of their fundraising is how much they raised relative to the average Democrat. FWL says: among candidates who are more ideologically extreme *for their party*, do they raise more or less *for their party*?\n\n\n## Two intuitions for controls\n\n\nWe've now seen two equivalent ways of thinking about what regression controls do:\n\n1. **Stratification**: split the data by $Z$, estimate the $X$-$Y$ relationship within each group, and take a weighted average. Controls ask: *within levels of Z, is there still a relationship between X and Y?*\n\n2. **Residualization (FWL)**: strip out what $Z$ explains from both $X$ and $Y$, and look at what's left. Controls ask: *using only the variation in X and Y that Z can't account for, is there a relationship?*\n\nWith categorical controls, stratification is the more intuitive framing ‚Äî you can literally look at subgroups. With continuous controls, you can't stratify, and FWL becomes the more natural way to think about it: regression removes a linear function of $Z$ from both sides and examines the leftovers. This is also why misspecifying the functional form of $Z$ matters. If $Z$'s true relationship with $Y$ is nonlinear but you control for it linearly, the residuals will still contain some of $Z$'s influence, and the confounding won't be fully removed.\n",
    "supporting": [
      "what-are-controls_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}